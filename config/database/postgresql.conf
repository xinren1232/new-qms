# PostgreSQL配置 - 针对2GB内存服务器优化

# 内存配置
shared_buffers = 64MB                    # 共享缓冲区 (约内存的25%)
effective_cache_size = 256MB             # 有效缓存大小
work_mem = 2MB                           # 工作内存
maintenance_work_mem = 32MB              # 维护工作内存
temp_buffers = 8MB                       # 临时缓冲区

# 连接配置
max_connections = 50                     # 最大连接数 (减少内存使用)
superuser_reserved_connections = 3       # 超级用户保留连接

# WAL配置
wal_buffers = 2MB                        # WAL缓冲区
checkpoint_completion_target = 0.9       # 检查点完成目标
wal_writer_delay = 200ms                 # WAL写入延迟

# 查询规划器配置
random_page_cost = 1.1                   # SSD优化
effective_io_concurrency = 200           # SSD并发IO

# 日志配置
log_destination = 'stderr'
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_min_duration_statement = 1000        # 记录超过1秒的查询

# 性能优化
shared_preload_libraries = 'pg_stat_statements'
track_activity_query_size = 2048
track_functions = all

# 自动清理配置
autovacuum = on
autovacuum_max_workers = 2               # 减少自动清理工作进程
autovacuum_naptime = 60s

# 时区配置
timezone = 'Asia/Shanghai'
log_timezone = 'Asia/Shanghai'

# 字符集配置
lc_messages = 'en_US.UTF-8'
lc_monetary = 'en_US.UTF-8'
lc_numeric = 'en_US.UTF-8'
lc_time = 'en_US.UTF-8'
default_text_search_config = 'pg_catalog.english'
