<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.transcend.plm.configcenter.permission.infrastructure.repository.mapper.PermissionInsanceMapper">

    <sql id="TableNameSql">

        <choose>
            <when test="table.useLogicTableName != null and table.useLogicTableName == 1">
                ${table.logicTableName}
            </when>
            <when test="table.tableNameSuffix != null">
                ${table.tenantCode}_model_${table.logicTableName}_${table.tableNameSuffix}
            </when>
            <otherwise>
                ${table.tenantCode}_model_${table.logicTableName}
            </otherwise>
        </choose>
    </sql>

<update id="updateDefaultPermissionBid">
    update <include refid="TableNameSql" /> set permission_bid = CONCAT('APP:',space_app_bid)  where ( permission_bid is null or permission_bid = 'DEFAULT:6666666666666')
    and space_app_bid in
    <foreach collection="appBids" item="appBid" open="(" close=")" separator=",">
        #{appBid}
    </foreach>
</update>

    <update id="updatePermissionBid">
        update <include refid="TableNameSql" /> set permission_bid = #{newPermissionBid} where permission_bid in
        <foreach collection="oldPermissionBids" item="oldPermissionBid" open="(" close=")" separator=",">
            #{oldPermissionBid}
        </foreach>
    </update>

</mapper>
