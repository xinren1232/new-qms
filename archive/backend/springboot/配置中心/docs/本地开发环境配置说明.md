# QMS-AI 本地开发环境配置说明

## 📋 配置概览

| 项目 | 值 |
|------|-----|
| **配置文件** | `application-loc.properties` |
| **配置日期** | 2025-01-23 |
| **环境类型** | 本地开发环境 |
| **操作系统** | Windows 11 |

## 🏗️ 系统架构

```
Windows 11 主机
├── Spring Boot 应用 (Java)
├── RabbitMQ 3.13.7 (Windows原生)
└── WSL2 Ubuntu 22.04
    └── Redis 6.0.16
```

## 🔧 服务配置详情

### 1. Redis 配置

#### 📦 部署信息
- **部署方式**: WSL2 Ubuntu 22.04
- **Redis版本**: 6.0.16
- **访问地址**: localhost:6379
- **认证**: 无密码 (本地开发)

#### 🔗 连接配置
```properties
spring.redis.host = localhost
spring.redis.port = 6379
spring.redis.password =
```

#### ⚠️ 重要说明
- **网络访问**: Windows通过WSL2自动端口转发访问Redis
- **安全配置**: Redis绑定127.0.0.1，仅允许本地访问
- **与初始设计差异**: 无差异，按原设计使用localhost

#### 🧪 连接测试
```bash
# 在WSL2中测试
wsl redis-cli ping
# 预期输出: PONG
```

### 2. RabbitMQ 配置

#### 📦 部署信息
- **部署方式**: Windows原生安装
- **RabbitMQ版本**: 3.13.7
- **Erlang版本**: OTP 26.2.5
- **管理界面**: http://localhost:15672

#### 🔗 连接配置
```properties
spring.rabbitmq.first.host = localhost
spring.rabbitmq.first.port = 5672
spring.rabbitmq.first.username = qms_ai_user
spring.rabbitmq.first.password = QmsAi@2025!
spring.rabbitmq.first.virtual-host = /qms-ai-loc
```

#### 👤 用户和权限
| 用户名 | 密码 | 角色 | 虚拟主机 | 权限 |
|--------|------|------|----------|------|
| `qms_ai_user` | `QmsAi@2025!` | administrator | `/qms-ai-loc` | Configure: `.*`<br>Write: `.*`<br>Read: `.*` |

#### ⚠️ 重要说明
- **服务状态**: Windows服务自动启动
- **Web管理**: guest/guest 可访问管理界面
- **与初始设计差异**: 无差异，完全按原设计实现

#### 🧪 连接测试
```bash
# 检查服务状态
netstat -an | findstr :5672
netstat -an | findstr :15672
```

## 🔄 服务管理命令

### Redis (WSL2)
```bash
# 启动Redis
wsl sudo systemctl start redis-server

# 停止Redis
wsl sudo systemctl stop redis-server

# 查看状态
wsl sudo systemctl status redis-server

# 连接测试
wsl redis-cli ping
```

### RabbitMQ (Windows)
```powershell
# 启动服务
.\rabbitmq-service.bat start

# 停止服务
.\rabbitmq-service.bat stop

# 查看状态
Get-Service RabbitMQ

# 管理界面
# http://localhost:15672
```

## 🚨 故障排除

### Redis 连接问题
1. **检查WSL2状态**: `wsl --list --verbose`
2. **检查Redis进程**: `wsl ps aux | grep redis`
3. **检查端口**: `wsl netstat -tlnp | grep 6379`

### RabbitMQ 连接问题
1. **检查Windows服务**: `Get-Service RabbitMQ`
2. **检查端口**: `netstat -an | findstr :5672`
3. **查看日志**: 检查 RabbitMQ 安装目录下的日志文件

## 📝 配置变更记录

| 日期 | 变更内容 | 原因 | 影响 | 变更类型 |
|------|----------|------|------|----------|
| 2025-01-23 | 初始配置完成 | 本地开发环境搭建 | 无 | 新增 |
| 2025-01-23 | 添加详细配置注释 | 便于维护和管理 | 无功能影响 | 优化 |
| 2025-01-23 | 增强服务启动脚本 | 适应实际构建需求 | 添加构建选项 | **变更** |

## 🔄 与初始设计的差异对比

### ✅ **完全符合初始设计的部分**
- **配置文件结构**: `application-loc.properties` 完全按原设计
- **服务配置**: Redis和RabbitMQ配置与设计一致
- **启动脚本**: 保持原有的批处理脚本架构
- **环境隔离**: 使用`loc`环境配置，符合多环境设计

### ⚠️ **实际实现的变更点**

#### 1. **构建流程变更**
- **初始设计**: 假设jar包已预先构建存在
- **实际实现**: 添加了Maven构建步骤
- **变更原因**: target目录中无预构建jar包
- **影响**: 启动前需要构建步骤，增加了选项7

#### 2. **环境检查增强**
- **初始设计**: 直接启动服务
- **实际实现**: 添加Redis和RabbitMQ状态检查
- **变更原因**: 确保依赖服务可用
- **影响**: 提高启动成功率，减少错误

#### 3. **错误处理优化**
- **初始设计**: 基本的错误提示
- **实际实现**: 详细的错误诊断和解决建议
- **变更原因**: 提升用户体验
- **影响**: 更好的故障排除能力

## 🔮 后续规划

### 生产环境迁移建议
1. **Redis**: 考虑使用Docker容器化部署
2. **RabbitMQ**: 考虑集群部署提高可用性
3. **配置管理**: 使用配置中心统一管理
4. **监控**: 添加服务监控和告警

### 开发环境优化
1. **自动化**: 编写启动脚本自动启动所有服务
2. **Docker**: 考虑使用Docker Compose统一管理
3. **备份**: 定期备份配置和数据

---

**文档维护**: 请在每次配置变更后及时更新此文档
**联系人**: 开发团队
**最后更新**: 2025-01-23
