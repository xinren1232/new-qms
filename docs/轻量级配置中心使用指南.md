# QMS-AI è½»é‡çº§é…ç½®ä¸­å¿ƒä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

QMS-AIè½»é‡çº§é…ç½®ä¸­å¿ƒæ˜¯ä¸“ä¸ºæœ¬åœ°å¼€å‘å’Œå°è§„æ¨¡éƒ¨ç½²è®¾è®¡çš„é…ç½®ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚å®ƒåŸºäºæ–‡ä»¶+å†…å­˜çš„æ¶æ„ï¼Œæä¾›é…ç½®çš„åŠ¨æ€ç®¡ç†å’Œçƒ­æ›´æ–°åŠŸèƒ½ï¼Œç‰¹åˆ«é€‚åˆç®¡ç†8ä¸ªAIæ¨¡å‹çš„é…ç½®ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½
- **ğŸ“ æ–‡ä»¶å­˜å‚¨**: é…ç½®ä»¥JSONæ–‡ä»¶å½¢å¼å­˜å‚¨ï¼Œä¾¿äºç‰ˆæœ¬æ§åˆ¶
- **ğŸ”„ çƒ­æ›´æ–°**: é…ç½®å˜æ›´è‡ªåŠ¨ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡
- **ğŸ¤– AIæ¨¡å‹ç®¡ç†**: ä¸“é—¨ä¼˜åŒ–çš„8ä¸ªAIæ¨¡å‹é…ç½®ç®¡ç†
- **ğŸ“¡ å®æ—¶é€šçŸ¥**: æ”¯æŒé…ç½®å˜æ›´çš„å®æ—¶é€šçŸ¥æœºåˆ¶
- **ğŸ”Œ HTTP API**: å®Œæ•´çš„RESTful APIæ¥å£
- **ğŸ“¤ å¯¼å…¥å¯¼å‡º**: æ”¯æŒé…ç½®çš„æ‰¹é‡å¯¼å…¥å¯¼å‡º
- **ğŸ’¾ æœ¬åœ°ç¼“å­˜**: å®¢æˆ·ç«¯ç¼“å­˜æœºåˆ¶ï¼Œæé«˜æ€§èƒ½
- **ğŸ¥ å¥åº·æ£€æŸ¥**: å®Œæ•´çš„æœåŠ¡å¥åº·ç›‘æ§

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨é…ç½®ä¸­å¿ƒ

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨é›†æˆå¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
start-with-config-center.bat

# æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨
cd backend/nodejs
node lightweight-config-service.js
```

### 2. å¯åŠ¨èŠå¤©æœåŠ¡

```bash
cd backend/nodejs
node chat-service.js
```

### 3. æµ‹è¯•åŠŸèƒ½

```bash
node test-config-center.js
```

## ğŸ”§ APIæ¥å£è¯´æ˜

### åŸºç¡€æ¥å£

#### å¥åº·æ£€æŸ¥
```http
GET /health
```

#### è·å–æ‰€æœ‰é…ç½®åç§°
```http
GET /api/configs
```

#### è·å–å•ä¸ªé…ç½®
```http
GET /api/configs/{configName}
GET /api/configs/{configName}?key=nested.key
```

#### è®¾ç½®é…ç½®
```http
POST /api/configs/{configName}
Content-Type: application/json

{
  "key": "value",
  "nested": {
    "key": "value"
  }
}
```

### AIæ¨¡å‹ä¸“ç”¨æ¥å£

#### è·å–æ‰€æœ‰AIæ¨¡å‹
```http
GET /api/ai/models
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "success": true,
  "data": {
    "default_model": "gpt-4o",
    "models": {
      "gpt-4o": {
        "name": "GPT-4o",
        "model": "gpt-4o",
        "apiKey": "sk-xxx",
        "baseURL": "https://api.openai.com/v1",
        "maxTokens": 4096,
        "temperature": 0.7,
        "features": {
          "reasoning": false,
          "tools": true,
          "vision": true
        },
        "enabled": true
      }
    }
  }
}
```

#### åˆ‡æ¢é»˜è®¤æ¨¡å‹
```http
POST /api/ai/models/switch
Content-Type: application/json

{
  "model_key": "deepseek-chat"
}
```

#### æ›´æ–°æ¨¡å‹é…ç½®
```http
PUT /api/ai/models/{modelKey}
Content-Type: application/json

{
  "maxTokens": 8192,
  "temperature": 0.8,
  "enabled": true
}
```

### é…ç½®ç®¡ç†æ¥å£

#### å¯¼å‡ºæ‰€æœ‰é…ç½®
```http
GET /api/export
```

#### å¯¼å…¥é…ç½®
```http
POST /api/import
Content-Type: application/json

{
  "configs": {
    "ai_models": { ... },
    "services": { ... }
  },
  "overwrite": false
}
```

#### å®æ—¶é…ç½®å˜æ›´é€šçŸ¥ï¼ˆSSEï¼‰
```http
GET /api/events/config-changes
```

## ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„

é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨ `backend/nodejs/config/data/` ç›®å½•ä¸‹ï¼š

```
config/data/
â”œâ”€â”€ ai_models.json      # AIæ¨¡å‹é…ç½®
â”œâ”€â”€ services.json       # æœåŠ¡é…ç½®
â””â”€â”€ system.json         # ç³»ç»Ÿé…ç½®
```

### AIæ¨¡å‹é…ç½®ç¤ºä¾‹ (ai_models.json)

```json
{
  "default_model": "gpt-4o",
  "models": {
    "gpt-4o": {
      "name": "GPT-4o",
      "model": "gpt-4o",
      "apiKey": "sk-xxx",
      "baseURL": "https://api.openai.com/v1",
      "maxTokens": 4096,
      "temperature": 0.7,
      "features": {
        "reasoning": false,
        "tools": true,
        "vision": true
      },
      "enabled": true
    },
    "deepseek-chat": {
      "name": "DeepSeek Chat (V3-0324)",
      "model": "deepseek-chat",
      "apiKey": "sk-xxx",
      "baseURL": "https://api.deepseek.com",
      "maxTokens": 4096,
      "temperature": 0.7,
      "features": {
        "reasoning": false,
        "tools": true,
        "vision": false
      },
      "enabled": true
    }
  },
  "rate_limits": {
    "requests_per_minute": 60,
    "requests_per_hour": 1000
  },
  "timeout": 30000,
  "retry_attempts": 3
}
```

## ğŸ”„ é…ç½®çƒ­æ›´æ–°æœºåˆ¶

### å·¥ä½œåŸç†
1. **æ–‡ä»¶ç›‘å¬**: é…ç½®ä¸­å¿ƒç›‘å¬é…ç½®æ–‡ä»¶å˜æ›´
2. **è‡ªåŠ¨é‡è½½**: æ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½é…ç½®
3. **äº‹ä»¶é€šçŸ¥**: é€šè¿‡EventEmitteré€šçŸ¥é…ç½®å˜æ›´
4. **å®¢æˆ·ç«¯æ›´æ–°**: èŠå¤©æœåŠ¡ç­‰å®¢æˆ·ç«¯è‡ªåŠ¨æ›´æ–°é…ç½®

### ä½¿ç”¨æ–¹å¼
1. **ç›´æ¥ç¼–è¾‘æ–‡ä»¶**: ä¿®æ”¹ `config/data/*.json` æ–‡ä»¶
2. **APIè°ƒç”¨**: é€šè¿‡HTTP APIæ›´æ–°é…ç½®
3. **é…ç½®ç«¯ç•Œé¢**: é€šè¿‡å‰ç«¯ç•Œé¢ç®¡ç†é…ç½®

## ğŸ›ï¸ å‰ç«¯é›†æˆ

### é…ç½®ç«¯é›†æˆ
åœ¨é…ç½®ç«¯æ·»åŠ é…ç½®ä¸­å¿ƒç®¡ç†ç•Œé¢ï¼š

```javascript
// è·å–AIæ¨¡å‹é…ç½®
async function getAIModels() {
  const response = await axios.get('/api/ai/models');
  return response.data;
}

// åˆ‡æ¢æ¨¡å‹
async function switchModel(modelKey) {
  const response = await axios.post('/api/ai/models/switch', {
    model_key: modelKey
  });
  return response.data;
}

// ç›‘å¬é…ç½®å˜æ›´
const eventSource = new EventSource('/api/events/config-changes');
eventSource.onmessage = function(event) {
  const data = JSON.parse(event.data);
  if (data.type === 'config_changed') {
    console.log('é…ç½®å·²å˜æ›´:', data.config_name);
    // æ›´æ–°ç•Œé¢
  }
};
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8082/health
```

### æŸ¥çœ‹é…ç½®çŠ¶æ€
```bash
curl http://localhost:8082/api/configs
```

### æŸ¥çœ‹AIæ¨¡å‹çŠ¶æ€
```bash
curl http://localhost:8082/api/ai/models
```

### æ—¥å¿—ç›‘æ§
é…ç½®ä¸­å¿ƒä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼š
- âœ… é…ç½®åŠ è½½æˆåŠŸ
- ğŸ“ é…ç½®æ–‡ä»¶å˜æ›´
- ğŸ“¢ é…ç½®å˜æ›´é€šçŸ¥
- âŒ é”™è¯¯ä¿¡æ¯

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. é…ç½®ä¸­å¿ƒå¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | findstr :8082

# æ£€æŸ¥é…ç½®ç›®å½•æƒé™
ls -la backend/nodejs/config/data/
```

#### 2. é…ç½®å˜æ›´ä¸ç”Ÿæ•ˆ
- æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦ä¸ºæœ‰æ•ˆJSON
- ç¡®è®¤æ–‡ä»¶ç›‘å¬å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œ
- æŸ¥çœ‹æœåŠ¡æ—¥å¿—è¾“å‡º

#### 3. èŠå¤©æœåŠ¡è¿æ¥é…ç½®ä¸­å¿ƒå¤±è´¥
- ç¡®è®¤é…ç½®ä¸­å¿ƒå·²å¯åŠ¨
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- éªŒè¯é…ç½®æœåŠ¡URL

### è°ƒè¯•æŠ€å·§

#### å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
export LOG_LEVEL=debug
node lightweight-config-service.js
```

#### æµ‹è¯•é…ç½®è¿æ¥
```bash
node test-config-center.js
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### é…ç½®ç¼“å­˜
- å®¢æˆ·ç«¯è‡ªåŠ¨ç¼“å­˜é…ç½®
- æ”¯æŒç¼“å­˜å¤±æ•ˆå’Œæ›´æ–°
- ç½‘ç»œæ•…éšœæ—¶ä½¿ç”¨ç¼“å­˜

### æ–‡ä»¶ç›‘å¬ä¼˜åŒ–
- ä½¿ç”¨èŠ‚æµæœºåˆ¶é¿å…é¢‘ç¹æ›´æ–°
- æ‰¹é‡å¤„ç†é…ç½®å˜æ›´
- å¼‚æ­¥å¤„ç†é…ç½®åŠ è½½

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½
- **é…ç½®ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒé…ç½®çš„ç‰ˆæœ¬æ§åˆ¶å’Œå›æ»š
- **é…ç½®éªŒè¯**: æ·»åŠ é…ç½®æ ¼å¼éªŒè¯å’Œçº¦æŸæ£€æŸ¥
- **é›†ç¾¤æ”¯æŒ**: æ”¯æŒå¤šå®ä¾‹é…ç½®åŒæ­¥
- **Webç•Œé¢**: æä¾›ä¸“é—¨çš„é…ç½®ç®¡ç†Webç•Œé¢
- **é…ç½®æ¨¡æ¿**: æ”¯æŒé…ç½®æ¨¡æ¿å’Œç»§æ‰¿æœºåˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ—¥å¿—è¾“å‡º
2. è¿è¡Œæµ‹è¯•è„šæœ¬
3. æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
4. å‚è€ƒæ•…éšœæ’é™¤æŒ‡å—

---

**QMS-AIè½»é‡çº§é…ç½®ä¸­å¿ƒ - è®©é…ç½®ç®¡ç†æ›´ç®€å•** ğŸš€
