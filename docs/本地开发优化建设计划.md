# 本地开发优化建设计划

目标：以最小代价提升本地开发效率与稳定性，不追求一次到位，采用“小步快跑 + 可回滚”的节奏。

## 1. 本地服务一键启动/停止
- Windows（.bat / PowerShell）：统一脚本启动 config(3003) / chat(3004) / auth(8084) / gateway(8085)
- 脚本功能：端口检测、自动延时、失败重试、最后打开浏览器
- 产物：scripts/local-start.bat、scripts/local-stop.bat

## 2. 本地健康自检（Windows 友好）
- 新增：scripts/local-healthcheck.ps1
- 检查项：端口监听、curl /health、近 50 行错误日志（pm2 或 node 日志）
- 输出：红/绿状态，失败项给出“最小指令”修复建议

## 3. Vite / 代理与环境变量统一
- 应用端：统一使用相对 /api，vite.config.js 代理到 http://localhost:8085
- 配置端：开发环境如需访问后端，统一代理到 8085
- env 文件：VITE_WS_BASE_URL 仅在确有 WS 服务时设置（否则留空）

## 4. 账号与数据初始化
- 本地默认账号：admin / admin123（已在 auth-service 中内置）
- seed 脚本：可选，快速生成示例会话与模型配置

## 5. 本地日志与调试体验
- 统一输出到 ./local-logs（.gitignore）
- 提供“常用抓手”：tail 最新错误、导出最近一次请求响应

## 6. 渐进式可观测性
- 提供 /metrics 开关（默认关闭，本地可打开）
- 若开启，推荐本地使用 docker-compose 启 Prometheus + Grafana（仅开发人员需要）

## 7. 质量与提交前校验（渐进）
- 先引入 eslint + prettier（前端），后端保留最少 eslint 规则
- pre-commit 做基础格式化即可（后续再加 test）

## 8. 节奏与分批落地
- 第 1 批（0.5 天）：local-start/stop、healthcheck、本地代理统一
- 第 2 批（0.5 天）：日志目录与常用抓手、账号初始化说明
- 第 3 批（1 天）：可选 /metrics + docker-compose 监控骨架
- 第 4 批（渐进）：eslint/prettier + pre-commit

> 每一批完成后，都产出一份“记录与回滚说明”。

