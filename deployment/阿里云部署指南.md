# QMS-AIé˜¿é‡Œäº‘éƒ¨ç½²æŒ‡å— - å†…å­˜ä¼˜åŒ–ç‰ˆ

## ğŸ¯ éƒ¨ç½²ç›®æ ‡

è§£å†³æœ¬åœ°å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜é—®é¢˜ï¼ˆ86%+ï¼‰ï¼Œå°†QMS-AIç³»ç»Ÿéƒ¨ç½²åˆ°é˜¿é‡Œäº‘ï¼Œå®ç°ï¼š
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–ï¼šä»1.5GBé™è‡³1GBä»¥ä¸‹
- äº‘ç«¯é«˜å¯ç”¨éƒ¨ç½²
- ç”Ÿäº§çº§ç›‘æ§å’Œæ—¥å¿—
- è‡ªåŠ¨åŒ–è¿ç»´ç®¡ç†

## ğŸ“‹ é˜¿é‡Œäº‘èµ„æºé…ç½®å»ºè®®

### ğŸ—ï¸ åŸºç¡€ç‰ˆé…ç½®ï¼ˆæ¨èï¼‰
```yaml
ECSå®ä¾‹:
  è§„æ ¼: ecs.c6.large (2æ ¸4GB)
  æ•°é‡: 1å°
  æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS
  å­˜å‚¨: 40GB SSDäº‘ç›˜
  å¸¦å®½: 5Mbps

RDSæ•°æ®åº“:
  è§„æ ¼: rds.mysql.s2.large (2æ ¸4GB)
  å­˜å‚¨: 20GB SSD
  ç‰ˆæœ¬: MySQL 8.0

Redisç¼“å­˜:
  è§„æ ¼: redis.master.small.default (1GB)
  ç‰ˆæœ¬: Redis 6.0

é¢„ä¼°è´¹ç”¨: çº¦400-600å…ƒ/æœˆ
```

### ğŸš€ ç”Ÿäº§ç‰ˆé…ç½®ï¼ˆé«˜æ€§èƒ½ï¼‰
```yaml
ECSå®ä¾‹:
  è§„æ ¼: ecs.c6.xlarge (4æ ¸8GB)
  æ•°é‡: 2å°ï¼ˆä¸»å¤‡ï¼‰
  æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS
  å­˜å‚¨: 100GB SSDäº‘ç›˜
  å¸¦å®½: 10Mbps

RDSæ•°æ®åº“:
  è§„æ ¼: rds.mysql.s3.large (4æ ¸8GB)
  å­˜å‚¨: 100GB SSD
  é«˜å¯ç”¨: ä¸»å¤‡ç‰ˆ

Redisç¼“å­˜:
  è§„æ ¼: redis.master.mid.default (4GB)
  é›†ç¾¤ç‰ˆ: 3èŠ‚ç‚¹

è´Ÿè½½å‡è¡¡: SLBåº”ç”¨å‹
CDN: å…¨ç«™åŠ é€Ÿ

é¢„ä¼°è´¹ç”¨: çº¦1200-1800å…ƒ/æœˆ
```

## ğŸš€ ä¸€é”®éƒ¨ç½²æµç¨‹

### æ­¥éª¤1: å‡†å¤‡é˜¿é‡Œäº‘ç¯å¢ƒ

1. **è´­ä¹°ECSå®ä¾‹**
   ```bash
   # ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
   # é€‰æ‹©ECS -> åˆ›å»ºå®ä¾‹
   # é…ç½®: Ubuntu 20.04 LTS, 2æ ¸4GB, 40GB SSD
   ```

2. **è´­ä¹°RDSæ•°æ®åº“**
   ```bash
   # é€‰æ‹©RDS -> åˆ›å»ºå®ä¾‹
   # é…ç½®: MySQL 8.0, 2æ ¸4GB, 20GBå­˜å‚¨
   # è®°å½•è¿æ¥ä¿¡æ¯: ä¸»æœºåœ°å€ã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç 
   ```

3. **è´­ä¹°Redisç¼“å­˜**
   ```bash
   # é€‰æ‹©Redis -> åˆ›å»ºå®ä¾‹
   # é…ç½®: Redis 6.0, 1GBå†…å­˜
   # è®°å½•è¿æ¥ä¿¡æ¯: ä¸»æœºåœ°å€ã€ç«¯å£ã€å¯†ç 
   ```

### æ­¥éª¤2: ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨

```bash
# æ–¹å¼ä¸€: ä½¿ç”¨Gitï¼ˆæ¨èï¼‰
ssh root@your-server-ip
cd /opt
git clone https://github.com/your-username/QMS-AI.git qms
cd qms

# æ–¹å¼äºŒ: ä½¿ç”¨SCPä¸Šä¼ 
scp -r ./QMS-AI root@your-server-ip:/opt/qms
```

### æ­¥éª¤3: é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cd /opt/qms
cp deployment/.env.aliyun .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env

# å¿…é¡»ä¿®æ”¹çš„é…ç½®é¡¹:
# ALIYUN_RDS_HOST=rm-xxxxxxx.mysql.rds.aliyuncs.com
# ALIYUN_RDS_PASSWORD=your_rds_password
# ALIYUN_REDIS_HOST=r-xxxxxxx.redis.rds.aliyuncs.com
# ALIYUN_REDIS_PASSWORD=your_redis_password
# DOMAIN=your-domain.com
# JWT_SECRET=your_secure_jwt_secret
# GRAFANA_PASSWORD=your_grafana_password
```

### æ­¥éª¤4: æ‰§è¡Œä¸€é”®éƒ¨ç½²

```bash
# è¿è¡Œéƒ¨ç½²è„šæœ¬
sudo ./deployment/aliyun-deploy.sh

# è„šæœ¬å°†è‡ªåŠ¨å®Œæˆ:
# 1. å®‰è£…Dockerå’ŒDocker Compose
# 2. é…ç½®ç³»ç»Ÿç¯å¢ƒ
# 3. æ„å»ºå’Œå¯åŠ¨æ‰€æœ‰æœåŠ¡
# 4. é…ç½®Nginxåå‘ä»£ç†
# 5. è®¾ç½®ç›‘æ§å’Œæ—¥å¿—
```

### æ­¥éª¤5: é…ç½®åŸŸåå’ŒSSL

```bash
# é…ç½®åŸŸåè§£æ
# åœ¨åŸŸåæœåŠ¡å•†å¤„æ·»åŠ Aè®°å½•: your-domain.com -> your-server-ip

# ç”³è¯·SSLè¯ä¹¦
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

## ğŸ“Š å†…å­˜ä¼˜åŒ–é…ç½®è¯¦è§£

### ğŸ”§ å®¹å™¨èµ„æºé™åˆ¶
```yaml
# è®¤è¯æœåŠ¡: 128MBå†…å­˜é™åˆ¶
qms-auth-service:
  deploy:
    resources:
      limits:
        memory: 128M
        cpus: '0.3'

# é…ç½®ä¸­å¿ƒ: 128MBå†…å­˜é™åˆ¶
qms-config-service:
  deploy:
    resources:
      limits:
        memory: 128M
        cpus: '0.3'

# èŠå¤©æœåŠ¡: 256MBå†…å­˜é™åˆ¶ï¼ˆä¸»è¦æœåŠ¡ï¼‰
qms-chat-service:
  deploy:
    resources:
      limits:
        memory: 256M
        cpus: '0.5'

# å‰ç«¯æœåŠ¡: 64MBå†…å­˜é™åˆ¶
qms-frontend:
  deploy:
    resources:
      limits:
        memory: 64M
        cpus: '0.2'
```

### ğŸš€ Node.jså†…å­˜ä¼˜åŒ–
```bash
# åœ¨Dockerfileä¸­è®¾ç½®å†…å­˜é™åˆ¶
NODE_OPTIONS=--max-old-space-size=128  # è®¤è¯å’Œé…ç½®æœåŠ¡
NODE_OPTIONS=--max-old-space-size=256  # èŠå¤©æœåŠ¡
```

### ğŸ’¾ Rediså†…å­˜ä¼˜åŒ–
```bash
# Redisé…ç½®ä¼˜åŒ–
maxmemory 128mb
maxmemory-policy allkeys-lru
```

## ğŸ§­ éå®¹å™¨åŒ–éƒ¨ç½²ï¼ˆPM2 + ç½‘å…³æ‰˜ç®¡é™æ€èµ„æºï¼‰

### åç«¯æœåŠ¡å®ˆæŠ¤ï¼ˆPM2ï¼‰
```bash
# å®‰è£… PM2
npm i -g pm2 --registry=https://registry.npmmirror.com

# ä½¿ç”¨ç”Ÿæ€é…ç½®å¯åŠ¨ä¸‰æœåŠ¡
cd /opt/qms-aliyun-deploy/backend/nodejs
pm2 start ecosystem.config.js
pm2 save
pm2 startup   # å¯é€‰ï¼šè®¾ç½®å¼€æœºè‡ªå¯

# æŸ¥çœ‹çŠ¶æ€ä¸æ—¥å¿—
pm2 status
pm2 logs qms-gateway --lines 200
```

### å‰ç«¯é™æ€èµ„æºéƒ¨ç½²ï¼ˆæœ€ä½æˆæœ¬æ–¹æ¡ˆï¼‰
```bash
# æ­¥éª¤1ï¼šæ„å»ºåº”ç”¨ç«¯
cd frontend/åº”ç”¨ç«¯
npm ci
npm run build

# å°† dist ä¸Šä¼ è‡³æœåŠ¡å™¨
scp -r dist/* root@æœåŠ¡å™¨:/opt/qms-aliyun-deploy/frontend/åº”ç”¨ç«¯/dist/

# æ­¥éª¤2ï¼šå°† Nginx æ ¹ç›®å½•æŒ‡å‘ åº”ç”¨ç«¯/distï¼ˆæˆ‘ä»¬å·²åœ¨ä»“åº“ä¸­è°ƒæ•´ï¼‰
# æ–‡ä»¶ï¼š/opt/qms-aliyun-deploy/nginx/nginx.conf
# å…³é”®ï¼šroot /usr/share/nginx/html/åº”ç”¨ç«¯/dist;

# æ­¥éª¤3ï¼šé‡è½½ Nginx
# å®¹å™¨å†…ï¼šdocker exec -it qms-nginx nginx -t && docker exec -it qms-nginx nginx -s reload
# éå®¹å™¨ï¼šnginx -t && nginx -s reload

# å¯é€‰ï¼šè®¿é—® /status æŸ¥çœ‹åŸé¦–é¡µï¼ˆç³»ç»ŸçŠ¶æ€é¡µï¼‰
```

> å¦‚éœ€ç»§ç»­ç”±â€œAPI ç½‘å…³â€æ‰˜ç®¡é™æ€èµ„æºï¼Œå¯æ”¹å›åŸæŒ‡å¼•ï¼šå°† dist æ”¾åˆ° /opt/qms-aliyun-deploy/frontend/åº”ç”¨ç«¯/distï¼Œ
> å¹¶æŠŠæ ¹è·¯å¾„ä»£ç†åˆ°å‰ç«¯å®¹å™¨æˆ–ç”±ç½‘å…³åˆ¤å®šã€‚ä½†ä»ç»´æŠ¤æˆæœ¬ä¸ç¨³å®šæ€§çœ‹ï¼Œç›´æ¥è®© Nginx ä»¥ åº”ç”¨ç«¯/dist ä½œä¸ºæ ¹æ›´ç®€å•ã€å¯é¢„æœŸã€‚

### ç«¯å£ä¸å¥åº·æ£€æŸ¥
```text
é…ç½®ä¸­å¿ƒ: 3003   -> http://æœåŠ¡å™¨:3003/health
èŠå¤©æœåŠ¡: 3004   -> http://æœåŠ¡å™¨:3004/health
API ç½‘å…³: 8085   -> http://æœåŠ¡å™¨:8085/health
```

### å¸¸è§é—®é¢˜
- å¦‚ / è¿”å›â€œç›®æ ‡æœåŠ¡ä¸å¯ç”¨â€ï¼Œå¤šä¸ºæœªæ‰¾åˆ°åº”ç”¨ç«¯ distï¼ŒæŒ‰ä¸Šæ–‡å°† dist æ”¾åˆ° frontend/åº”ç”¨ç«¯/dist å¹¶é‡å¯ç½‘å…³å³å¯
- å¦‚ /config 404ï¼Œå¤šä¸ºæœªæ‰¾åˆ°é…ç½®ç«¯ distï¼Œæ”¾ç½®åˆ° frontend/é…ç½®ç«¯/dist å¹¶é‡å¯ç½‘å…³
- é‡å¯ç½‘å…³ï¼špm2 restart qms-gateway

## ğŸ” ç›‘æ§å’Œè¿ç»´

### ğŸ“ˆ ç³»ç»Ÿç›‘æ§
```bash
# è¿è¡Œç›‘æ§è„šæœ¬
./deployment/monitor-system.sh

# è‡ªåŠ¨ç›‘æ§ï¼ˆæ¯30ç§’åˆ·æ–°ï¼‰
watch -n 30 ./deployment/monitor-system.sh
```

### ğŸ“ æ—¥å¿—ç®¡ç†
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose -f deployment/aliyun-deploy-optimized.yml logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose -f deployment/aliyun-deploy-optimized.yml logs -f qms-chat-service

# æ¸…ç†æ—¥å¿—
docker system prune -f
```

### ğŸ”„ æœåŠ¡ç®¡ç†
```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose -f deployment/aliyun-deploy-optimized.yml restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose -f deployment/aliyun-deploy-optimized.yml restart qms-chat-service

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose -f deployment/aliyun-deploy-optimized.yml down

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f deployment/aliyun-deploy-optimized.yml up -d
```

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### ğŸ”’ é˜²ç«å¢™è®¾ç½®
```bash
# Ubuntué˜²ç«å¢™é…ç½®
sudo ufw enable
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw status
```

### ğŸ” å¯†é’¥ç®¡ç†
```bash
# ç”Ÿæˆå¼ºå¯†é’¥
openssl rand -base64 32  # JWT_SECRET
openssl rand -base64 32  # ENCRYPTION_KEY
```

## ğŸ“± è®¿é—®åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **ğŸŒ ä¸»åº”ç”¨**: https://your-domain.com
- **ğŸ’¬ AIèŠå¤©**: https://your-domain.com/ai-management/chat
- **ğŸ¤– æ¨¡å‹ç®¡ç†**: https://your-domain.com/ai-management/models
- **ğŸ“Š ç›‘æ§é¢æ¿**: https://your-domain.com/grafana/
- **ğŸ” å¥åº·æ£€æŸ¥**: https://your-domain.com/api/chat/health

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è§£å†³

1. **å†…å­˜ä¸è¶³**
   ```bash
   # æ£€æŸ¥å†…å­˜ä½¿ç”¨
   free -h
   docker stats
   
   # é‡å¯é«˜å†…å­˜ä½¿ç”¨çš„å®¹å™¨
   docker-compose restart qms-chat-service
   ```

2. **æœåŠ¡æ— æ³•å¯åŠ¨**
   ```bash
   # æ£€æŸ¥æ—¥å¿—
   docker-compose logs qms-chat-service
   
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tuln | grep 3004
   ```

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥RDSç™½åå•è®¾ç½®
   # ç¡®ä¿ECS IPå·²æ·»åŠ åˆ°RDSç™½åå•
   
   # æµ‹è¯•è¿æ¥
   mysql -h your-rds-host -u username -p
   ```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. é˜¿é‡Œäº‘èµ„æºé…ç½®æ˜¯å¦æ­£ç¡®
2. ç¯å¢ƒå˜é‡æ˜¯å¦å®Œæ•´é…ç½®
3. ç½‘ç»œå®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ç›¸åº”ç«¯å£
4. åŸŸåè§£ææ˜¯å¦æ­£ç¡®æŒ‡å‘æœåŠ¡å™¨IP

---

**ğŸ‰ éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„QMS-AIç³»ç»Ÿå°†æ‹¥æœ‰ï¼š**
- âœ… å†…å­˜ä½¿ç”¨ä¼˜åŒ–ï¼ˆ<1GBï¼‰
- âœ… é«˜å¯ç”¨äº‘ç«¯éƒ¨ç½²
- âœ… å®Œæ•´ç›‘æ§ä½“ç³»
- âœ… è‡ªåŠ¨åŒ–è¿ç»´ç®¡ç†
- âœ… ç”Ÿäº§çº§å®‰å…¨é…ç½®
