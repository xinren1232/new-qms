/**
 * Coze Studio 响应式设计优化
 * 针对移动端、平板端的适配优化
 */

// 断点定义
$breakpoints: (
  'mobile': 767px,
  'tablet': 1023px,
  'desktop': 1024px,
  'large': 1440px
);

// 混入函数
@mixin mobile {
  @media (max-width: #{map-get($breakpoints, 'mobile')}) {
    @content;
  }
}

@mixin tablet {
  @media (min-width: #{map-get($breakpoints, 'mobile') + 1px}) and (max-width: #{map-get($breakpoints, 'tablet')}) {
    @content;
  }
}

@mixin desktop {
  @media (min-width: #{map-get($breakpoints, 'desktop')}) {
    @content;
  }
}

@mixin mobile-tablet {
  @media (max-width: #{map-get($breakpoints, 'tablet')}) {
    @content;
  }
}

// ==================== Coze Studio 主容器优化 ====================

.coze-studio-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;

  @include mobile {
    // 移动端全屏布局
    .coze-header {
      padding: 0 12px;
      height: 56px;
      flex-shrink: 0;
      
      .header-left {
        .logo-section {
          .coze-logo {
            .logo-text {
              display: none; // 隐藏文字，只显示图标
            }
          }
          
          .breadcrumb-section {
            display: none; // 隐藏面包屑
          }
        }
      }
      
      .header-center {
        .global-search {
          display: none; // 隐藏搜索框，可通过按钮展开
        }
      }
      
      .header-right {
        gap: 8px;
        
        .el-dropdown {
          .el-button {
            padding: 8px 12px;
            font-size: 14px;
          }
        }
        
        .el-badge {
          .el-button {
            padding: 8px;
          }
        }
      }
    }
    
    .coze-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      
      .coze-sidebar {
        position: fixed;
        top: 56px;
        left: 0;
        width: 280px;
        height: calc(100vh - 56px);
        background: var(--el-bg-color);
        border-right: 1px solid var(--el-border-color);
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 1000;
        overflow-y: auto;
        
        &.mobile-open {
          transform: translateX(0);
        }
        
        .workspace-info {
          padding: 16px;
          border-bottom: 1px solid var(--el-border-color-lighter);
        }
        
        .nav-menu {
          padding: 8px;
          
          .nav-item {
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 8px;
            
            .nav-icon {
              margin-right: 12px;
            }
            
            .nav-text {
              font-size: 14px;
            }
          }
        }
      }
      
      .coze-content {
        flex: 1;
        overflow: auto;
        padding: 16px 12px;
      }
    }
  }

  @include tablet {
    .coze-header {
      padding: 0 16px;
      height: 60px;
      
      .header-center {
        .global-search {
          .el-input {
            width: 250px !important;
          }
        }
      }
    }
    
    .coze-main {
      .coze-sidebar {
        width: 240px;
        
        .nav-menu {
          .nav-item {
            padding: 10px 14px;
            
            .nav-text {
              font-size: 13px;
            }
          }
        }
      }
      
      .coze-content {
        margin-left: 240px;
        padding: 20px;
      }
    }
  }

  @include desktop {
    .coze-main {
      .coze-sidebar {
        width: 280px;
      }
      
      .coze-content {
        margin-left: 280px;
        padding: 24px;
      }
    }
  }
}

// ==================== 工作流设计器移动端优化 ====================

.coze-workflow-builder {
  @include mobile {
    .builder-toolbar {
      padding: 8px 12px;
      flex-wrap: wrap;
      gap: 8px;
      
      .toolbar-left {
        h3 {
          font-size: 16px;
          margin: 0;
        }
      }
      
      .toolbar-right {
        .el-button {
          padding: 6px 12px;
          font-size: 12px;
        }
      }
    }
    
    .builder-main {
      flex-direction: column;
      
      .node-panel {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 200px;
        background: var(--el-bg-color);
        border-top: 1px solid var(--el-border-color);
        transform: translateY(100%);
        transition: transform 0.3s ease;
        z-index: 999;
        
        &.mobile-open {
          transform: translateY(0);
        }
        
        .panel-header {
          padding: 12px 16px;
          border-bottom: 1px solid var(--el-border-color-lighter);
          
          .panel-toggle {
            display: block;
          }
        }
        
        .panel-content {
          height: calc(100% - 48px);
          overflow-y: auto;
          
          .node-list {
            .node-item {
              padding: 8px 12px;
              margin: 4px 8px;
              
              .node-icon {
                width: 32px;
                height: 32px;
              }
              
              .node-info {
                .node-name {
                  font-size: 12px;
                }
                
                .node-desc {
                  font-size: 10px;
                }
              }
            }
          }
        }
      }
      
      .workflow-canvas {
        flex: 1;
        touch-action: pan-x pan-y;
        
        .workflow-node {
          min-width: 100px;
          min-height: 50px;
          
          .node-header {
            padding: 6px 8px;
            
            .node-title {
              font-size: 12px;
            }
          }
          
          .node-content {
            padding: 6px 8px;
            font-size: 11px;
          }
          
          .node-ports {
            .port {
              width: 8px;
              height: 8px;
            }
          }
        }
        
        .workflow-connection {
          stroke-width: 2;
        }
      }
    }
  }

  @include tablet {
    .builder-main {
      .node-panel {
        width: 200px;
        
        .node-list {
          .node-item {
            padding: 6px 10px;
            
            .node-icon {
              width: 28px;
              height: 28px;
            }
          }
        }
      }
      
      .workflow-canvas {
        .workflow-node {
          min-width: 120px;
          min-height: 60px;
        }
      }
    }
  }
}

// ==================== Agent Builder 移动端优化 ====================

.coze-agent-builder {
  @include mobile {
    .builder-toolbar {
      padding: 8px 12px;
      flex-wrap: wrap;
      
      .toolbar-right {
        width: 100%;
        margin-top: 8px;
        justify-content: space-between;
        
        .el-button {
          flex: 1;
          margin: 0 4px;
          padding: 8px 4px;
          font-size: 12px;
        }
      }
    }
    
    .builder-main {
      flex-direction: column;
      
      .config-panel {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60vh;
        background: var(--el-bg-color);
        border-top: 1px solid var(--el-border-color);
        transform: translateY(100%);
        transition: transform 0.3s ease;
        z-index: 999;
        
        &.mobile-open {
          transform: translateY(0);
        }
        
        .section-card {
          margin: 8px;
          
          h4 {
            font-size: 14px;
            margin-bottom: 8px;
          }
          
          .el-form {
            .el-form-item {
              margin-bottom: 12px;
              
              .el-form-item__label {
                font-size: 12px;
              }
              
              .el-input,
              .el-select,
              .el-textarea {
                font-size: 14px;
              }
            }
          }
        }
      }
      
      .preview-panel {
        flex: 1;
        padding: 12px;
        
        .chat-container {
          height: 100%;
          
          .chat-messages {
            .message-item {
              margin-bottom: 12px;
              
              .message-content {
                padding: 8px 12px;
                font-size: 14px;
                line-height: 1.4;
              }
            }
          }
          
          .chat-input {
            .el-input {
              .el-input__inner {
                font-size: 14px;
              }
            }
          }
        }
      }
    }
  }
}

// ==================== 知识库管理移动端优化 ====================

.knowledge-page {
  @include mobile {
    .page-header {
      padding: 12px;
      flex-direction: column;
      align-items: stretch;
      
      .header-left {
        margin-bottom: 12px;
        
        h1 {
          font-size: 20px;
          margin-bottom: 4px;
        }
        
        p {
          font-size: 14px;
        }
      }
      
      .header-right {
        .el-button {
          width: 100%;
          padding: 10px;
        }
      }
    }
    
    .filter-section {
      padding: 0 12px 12px;
      
      .el-row {
        .el-col {
          margin-bottom: 8px;
          
          .el-input,
          .el-select {
            width: 100%;
          }
        }
      }
    }
    
    .knowledge-grid {
      padding: 0 12px;
      grid-template-columns: 1fr;
      gap: 12px;
      
      .knowledge-card {
        .knowledge-content {
          h3 {
            font-size: 16px;
          }
          
          p {
            font-size: 14px;
          }
          
          .knowledge-stats {
            flex-wrap: wrap;
            gap: 8px;
            
            .stat-item {
              .stat-label {
                font-size: 11px;
              }
              
              .stat-value {
                font-size: 13px;
              }
            }
          }
        }
      }
    }
  }

  @include tablet {
    .knowledge-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
  }
}

// ==================== 通用移动端优化 ====================

@include mobile {
  // 对话框优化
  .el-dialog {
    width: 95% !important;
    margin: 5vh auto !important;
    
    .el-dialog__header {
      padding: 16px 20px 12px;
      
      .el-dialog__title {
        font-size: 16px;
      }
    }
    
    .el-dialog__body {
      padding: 12px 20px 20px;
      max-height: 70vh;
      overflow-y: auto;
    }
  }
  
  // 表格优化
  .el-table {
    font-size: 12px;
    
    .el-table__header {
      th {
        padding: 8px 4px;
        font-size: 11px;
      }
    }
    
    .el-table__body {
      td {
        padding: 8px 4px;
      }
    }
  }
  
  // 表单优化
  .el-form {
    .el-form-item {
      margin-bottom: 16px;
      
      .el-form-item__label {
        font-size: 13px;
        line-height: 1.4;
      }
      
      .el-form-item__content {
        .el-input,
        .el-select,
        .el-textarea {
          font-size: 14px;
        }
      }
    }
  }
  
  // 按钮优化
  .el-button {
    padding: 8px 16px;
    font-size: 14px;
    
    &.el-button--small {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    &.el-button--mini {
      padding: 4px 8px;
      font-size: 11px;
    }
  }
  
  // 卡片优化
  .el-card {
    .el-card__header {
      padding: 12px 16px;
      
      .card-header {
        font-size: 14px;
      }
    }
    
    .el-card__body {
      padding: 12px 16px;
    }
  }
}

// ==================== 触摸优化 ====================

@include mobile-tablet {
  // 增加触摸目标大小
  .touchable {
    min-height: 44px;
    min-width: 44px;
  }
  
  // 工作流节点触摸优化
  .workflow-node {
    .node-ports {
      .port {
        min-width: 20px;
        min-height: 20px;
        border-radius: 50%;
        
        &::before {
          content: '';
          position: absolute;
          top: -6px;
          left: -6px;
          right: -6px;
          bottom: -6px;
          border-radius: 50%;
        }
      }
    }
  }
  
  // 滚动条优化
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
  
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  
  ::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
  }
}

// ==================== 性能优化 ====================

@include mobile {
  // 减少动画和过渡效果
  * {
    transition-duration: 0.2s !important;
  }
  
  // 优化渲染性能
  .workflow-canvas {
    will-change: transform;
  }
  
  .coze-sidebar {
    will-change: transform;
  }
  
  // 减少阴影效果
  .el-card,
  .el-dialog,
  .el-dropdown-menu {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  }
}
